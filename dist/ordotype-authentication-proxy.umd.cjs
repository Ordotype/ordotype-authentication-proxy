(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){"use strict";var p=Object.defineProperty;var b=(n,i,l)=>i in n?p(n,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[i]=l;var g=(n,i,l)=>b(n,typeof i!="symbol"?i+"":i,l);const n={LOGOUT:"memberstack.logout",GET_APP:"memberstack.getApp",LOGIN:"memberstack.login"};function i(){window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(window.$memberstackDom,{get(r,e){const t=r[e];return typeof t=="function"?async function(...o){var s;if(console.log(`Method ${e} called with arguments: ${JSON.stringify(o)}`),e==="logout"){const a=new Event(n.LOGOUT,{bubbles:!1,cancelable:!1});document.dispatchEvent(a)}if(e==="getApp"){const a=new Event(n.GET_APP,{bubbles:!1,cancelable:!1});document.dispatchEvent(a)}if(e==="loginMemberEmailPassword"){const a=new Event(n.LOGIN,{bubbles:!1,cancelable:!1});return document.dispatchEvent(a),((s=window._msConfig)==null?void 0:s.preventLogin)&&!1}return t.apply(r,o)}:t}})}function l(){const r="_ga_7T2LX34911",e=document.cookie.split("; ");for(const t of e){const[o,s]=t.split("=");if(o===r)return s}throw new Error("Device Id cookie not found")}function m(){return!!localStorage.getItem("_ms-mid")}const h="https://staging-api.ordotype.fr/v1.0.0";class u extends Error{constructor(t,o=500){super(t);g(this,"status");this.name="AuthError",this.status=o,Error.captureStackTrace&&Error.captureStackTrace(this,u)}}class w{constructor(){g(this,"headers");const e="pk_sb_e80d8429a51c2ceb0530",t=window.localStorage.getItem("ms_session_id"),o=l();this.headers={"X-Api-Key":e,"X-Session-Id":t??void 0,"X-Device-Id":o??void 0}}async request(e,t,o="GET",s=null,a={}){const d=`${h}/${t}/${e}`,S={"Content-Type":"application/json",...this.headers,...a},v={method:o,headers:S,...s&&{body:JSON.stringify(s)}};try{const c=await fetch(d,v);if(!c.ok)throw new u(c.statusText,c.status);return await c.json()}catch(c){throw console.error("API Request Failed:",c),c}}async validateSessionStatus(){try{if(!m())return null;const e=localStorage.getItem("_ms-mid");return await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${e}`})}catch(e){throw console.error("Session validation failed:",e),e}}async logout(){try{if(!m())return;const e=localStorage.getItem("_ms-mid");await this.request("logout","auth","POST",null,{Authorization:`Bearer ${e}`}),localStorage.removeItem("_ms-mid")}catch(e){throw console.error("Session logout failed:",e),e}}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?decodeURIComponent(t[2]):null}setCookie(e,t,o){const s=new Date;s.setTime(s.getTime()+o),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${s.toUTCString()}; path=/`}async throttle(e,t,o){const s=this.getCookie(t),a=Date.now();if(s&&a-parseInt(s,10)<o)return console.log(`Skipping execution of ${t}: Throttled.`),null;console.log(`Executing ${t}...`);const d=await e();return this.setCookie(t,a.toString(),o),d}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle(()=>this.validateSessionStatus(),"lastSessionValidation",3*60*1e3):Promise.resolve(null)}}i();const f=new w;document.addEventListener(n.GET_APP,async()=>{if(console.log("getApp"),!!m())try{if(await f.validateSessionStatus()===!1){await window.$memberstackDom.logout(),window.location.href="/";return}}catch(r){if(r instanceof u){(r.status===401||r.status===403)&&await window.$memberstackDom.logout(),window.location.href="/";return}}}),document.addEventListener(n.LOGOUT,async()=>{console.log("logout"),await f.logout(),localStorage.removeItem("_ms-mid"),localStorage.removeItem("_ms_mem")})});
