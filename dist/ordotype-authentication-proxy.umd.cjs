(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){"use strict";var v=Object.defineProperty;var S=(n,a,l)=>a in n?v(n,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[a]=l;var d=(n,a,l)=>S(n,typeof a!="symbol"?a+"":a,l);const n={LOGOUT:"memberstack.logout",GET_APP:"memberstack.getApp",LOGIN:"memberstack.login"};function a(){window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(window.$memberstackDom,{get(i,e){const t=i[e];return typeof t=="function"?async function(...s){var o;if(console.log(`Method ${e} called with arguments: ${JSON.stringify(s)}`),e==="logout"){const r=new Event(n.LOGOUT,{bubbles:!1,cancelable:!1});document.dispatchEvent(r)}if(e==="getApp"){const r=new Event(n.GET_APP,{bubbles:!1,cancelable:!1});document.dispatchEvent(r)}if(e==="loginMemberEmailPassword"){const r=new Event(n.LOGIN,{bubbles:!1,cancelable:!1});return document.dispatchEvent(r),((o=window._msConfig)==null?void 0:o.preventLogin)&&!1}return t.apply(i,s)}:t}})}function l(){const i="_ga_7T2LX34911",e=document.cookie.split("; ");for(const t of e){const[s,o]=t.split("=");if(s===i)return o}throw new Error("Device Id cookie not found")}function u(){return!!localStorage.getItem("_ms-mid")}const g="https://staging-api.ordotype.fr/v1.0.0";class f{constructor(){d(this,"headers");const e="pk_sb_e80d8429a51c2ceb0530",t=window.localStorage.getItem("ms_session_id"),s=l();this.headers={"X-Api-Key":e,"X-Session-Id":t??void 0,"X-Device-Id":s??void 0}}async request(e,t,s="GET",o=null,r={}){const m=`${g}/${t}/${e}`,h={"Content-Type":"application/json",...this.headers,...r},w={method:s,headers:h,...o&&{body:JSON.stringify(o)}};try{const c=await fetch(m,w);if(!c.ok)throw new Error(`Error ${c.status}: ${c.statusText}`);return await c.json()}catch(c){throw console.error("API Request Failed:",c),c}}async validateSessionStatus(){try{if(!u())return null;const e=localStorage.getItem("_ms-mid");return await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${e}`})}catch(e){throw console.error("Session validation failed:",e),e}}async logout(){try{if(!u())return;const e=localStorage.getItem("_ms-mid");await this.request("logout","auth","POST",null,{Authorization:`Bearer ${e}`}),localStorage.removeItem("_ms-mid")}catch(e){throw console.error("Session logout failed:",e),e}}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?decodeURIComponent(t[2]):null}setCookie(e,t,s){const o=new Date;o.setTime(o.getTime()+s),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${o.toUTCString()}; path=/`}async throttle(e,t,s){const o=this.getCookie(t),r=Date.now();if(o&&r-parseInt(o,10)<s)return console.log(`Skipping execution of ${t}: Throttled.`),null;console.log(`Executing ${t}...`);const m=await e();return this.setCookie(t,r.toString(),s),m}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle(()=>this.validateSessionStatus(),"lastSessionValidation",3*60*1e3):Promise.resolve(null)}}a(),document.addEventListener(n.GET_APP,async()=>{if(console.log("getApp"),!u())return;const i=new f;try{if(await i.validateSessionStatus()===!1){await i.logout(),window.location.href="/";return}}catch(e){if(e instanceof Error&&"status"in e&&e.status===403){await i.logout(),window.location.href="/";return}}})});
