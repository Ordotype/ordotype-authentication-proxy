(function(r){typeof define=="function"&&define.amd?define(r):r()})(function(){"use strict";var v=Object.defineProperty;var k=(r,i,l)=>i in r?v(r,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[i]=l;var m=(r,i,l)=>k(r,typeof i!="symbol"?i+"":i,l);const r={LOGOUT:"memberstack.logout",GET_APP:"memberstack.getApp",LOGIN:"memberstack.login"};function i(){window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(window.$memberstackDom,{get(s,e){const t=s[e];return typeof t=="function"?async function(...o){var n;if(console.log(`Method ${e} called with arguments: ${JSON.stringify(o)}`),e==="logout"){const a=new Event(r.LOGOUT,{bubbles:!1,cancelable:!1});return document.dispatchEvent(a),!1}if(e==="getApp"){const a=new Event(r.GET_APP,{bubbles:!1,cancelable:!1});document.dispatchEvent(a)}if(e==="loginMemberEmailPassword"){const a=new CustomEvent(r.LOGIN,{bubbles:!1,cancelable:!1,detail:o[0]});return document.dispatchEvent(a),((n=window._msConfig)==null?void 0:n.preventLogin)&&!1}return t.apply(s,o)}:t}})}function l(){const s="_ga_7T2LX34911",e=document.cookie.split("; ");for(const t of e){const[o,n]=t.split("=");if(o===s)return n}throw new Error("Device Id cookie not found")}const h="https://staging-api.ordotype.fr/v1.0.0";class u extends Error{constructor(t,o=500){super(t);m(this,"status");this.name="AuthError",this.status=o,Error.captureStackTrace&&Error.captureStackTrace(this,u)}}class f extends Error{constructor(t,o,n){super(t);m(this,"data");m(this,"type");this.name="TwoFactorRequiredError",this.data=o,this.type=n}}class w{constructor(){m(this,"headers");const e="pk_sb_e80d8429a51c2ceb0530",t=window.localStorage.getItem("ms_session_id"),o=l();this.headers={"X-Api-Key":e,"X-Session-Id":t??void 0,"X-Device-Id":o??void 0}}async request(e,t,o="GET",n=null,a={}){const g=`${h}/${t}/${e}`,S={"Content-Type":"application/json",...this.headers,...a},b={method:o,headers:S,...n&&{body:JSON.stringify(n)}};try{const c=await fetch(g,b);if(!c.ok)throw new u(c.statusText,c.status);return c.status===204||!c.body?null:await c.json()}catch(c){throw console.error("API Request Failed:",c),c}}async validateSessionStatus(){try{const e=localStorage.getItem("_ms-mid");return await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${e}`})}catch(e){throw console.error("Session validation failed:",e),e}}async logout(){try{const e=localStorage.getItem("_ms-mid");await this.request("logout","auth","POST",null,{Authorization:`Bearer ${e}`}),localStorage.removeItem("_ms-mid")}catch(e){throw console.error("Session logout failed:",e),e}}async login(e){const t={...e,options:{includeContentGroups:!0,isWebflow:!0},device:this.headers["X-Device-Id"]??"unknown"},o=await this.request("login","auth","POST",t,{});if(p(o))throw new f("2fa required",o.data,o.type);return o}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?decodeURIComponent(t[2]):null}setCookie(e,t,o){const n=new Date;n.setTime(n.getTime()+o),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${n.toUTCString()}; path=/`}async throttle(e,t,o){const n=this.getCookie(t),a=Date.now();if(n&&a-parseInt(n,10)<o)return console.log(`Skipping execution of ${t}: Throttled.`),null;console.log(`Executing ${t}...`);const g=await e();return this.setCookie(t,a.toString(),o),g}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle(()=>this.validateSessionStatus(),"lastSessionValidation",3*60*1e3):Promise.resolve(null)}}function p(s){return"data"in s&&typeof s.data=="object"&&"type"in s}i();const d=new w;document.addEventListener(r.GET_APP,async()=>{function s(){return!!localStorage.getItem("_ms-mid")}if(location.href.includes("challenge")){console.log("Avoided verification on challenge page");return}if(console.log("getApp"),!!s())try{if(await d.validateSessionStatus()===!1){await window.$memberstackDom.logout();return}}catch(e){if(e instanceof u){(e.status===401||e.status===403)&&await window.$memberstackDom.logout();return}}}),document.addEventListener(r.LOGOUT,async()=>{function s(){return!!localStorage.getItem("_ms-mid")}if(console.log("logout"),!s()){console.log("Member is not logged in.");return}try{await d.logout()}catch(e){e instanceof u&&(e.status===401||e.status===403)&&console.log("Member is already logged out from the server.")}localStorage.removeItem("_ms-mid"),localStorage.removeItem("_ms_mem"),window.location.href="/"}),document.addEventListener(r.LOGIN,async s=>{function e(){return!!localStorage.getItem("_ms-mid")}if(console.log("login"),e()){console.log("Member is already logged in.");return}try{const{detail:t}=s,o=await d.login({email:t.email,password:t.password});localStorage.setItem("_ms-mid",o.data.tokens.accessToken),localStorage.setItem("_ms-mem",JSON.stringify(o.data.member)),window.location.href=o.data.redirect}catch(t){if(t instanceof f){const o="_ms-2fa-session",n=JSON.stringify({data:t.data,type:t.type});sessionStorage.setItem(o,n),window.location.href=void 0;return}throw t}})});
