(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){"use strict";var w=Object.defineProperty;var v=(n,a,l)=>a in n?w(n,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[a]=l;var d=(n,a,l)=>v(n,typeof a!="symbol"?a+"":a,l);const n={LOGOUT:"memberstack.logout",GET_APP:"memberstack.getApp",LOGIN:"memberstack.login"};function a(){window._msConfig||(window._msConfig={preventLogin:!0}),window.$memberstackDom=new Proxy(window.$memberstackDom,{get(r,e){const t=r[e];return typeof t=="function"?async function(...s){var o;if(console.log(`Method ${e} called with arguments: ${JSON.stringify(s)}`),e==="logout"){const i=new Event(n.LOGOUT,{bubbles:!1,cancelable:!1});document.dispatchEvent(i)}if(e==="getApp"){const i=new Event(n.GET_APP,{bubbles:!1,cancelable:!1});document.dispatchEvent(i)}if(e==="loginMemberEmailPassword"){const i=new Event(n.LOGIN,{bubbles:!1,cancelable:!1});return document.dispatchEvent(i),((o=window._msConfig)==null?void 0:o.preventLogin)&&!1}return t.apply(r,s)}:t}})}function l(){const r="_ga_7T2LX34911",e=document.cookie.split("; ");for(const t of e){const[s,o]=t.split("=");if(s===r)return o}throw new Error("Device Id cookie not found")}const m="https://staging-api.ordotype.fr/v1.0.0";class g{constructor(){d(this,"headers");const e="pk_sb_e80d8429a51c2ceb0530",t=window.localStorage.getItem("ms_session_id"),s=l();this.headers={"X-Api-Key":e,"X-Session-Id":t??void 0,"X-Device-Id":s??void 0}}async request(e,t,s="GET",o=null,i={}){const u=`${m}/${t}/${e}`,h={"Content-Type":"application/json",...this.headers,...i},f={method:s,headers:h,...o&&{body:JSON.stringify(o)}};try{const c=await fetch(u,f);if(!c.ok)throw new Error(`Error ${c.status}: ${c.statusText}`);return await c.json()}catch(c){throw console.error("API Request Failed:",c),c}}async validateSessionStatus(){try{const e=localStorage.getItem("_ms-mid");return e?await this.request("validate-session-status","auth","POST",null,{Authorization:`Bearer ${e}`}):null}catch(e){throw console.error("Session validation failed:",e),e}}async logout(){try{const e=localStorage.getItem("_ms-mid");if(!e)return;await this.request("logout","auth","POST",null,{Authorization:`Bearer ${e}`}),localStorage.removeItem("_ms-mid")}catch(e){throw console.error("Session logout failed:",e),e}}getCookie(e){const t=document.cookie.match(new RegExp(`(^| )${e}=([^;]+)`));return t?decodeURIComponent(t[2]):null}setCookie(e,t,s){const o=new Date;o.setTime(o.getTime()+s),document.cookie=`${e}=${encodeURIComponent(t)}; expires=${o.toUTCString()}; path=/`}async throttle(e,t,s){const o=this.getCookie(t),i=Date.now();if(o&&i-parseInt(o,10)<s)return console.log(`Skipping execution of ${t}: Throttled.`),null;console.log(`Executing ${t}...`);const u=await e();return this.setCookie(t,i.toString(),s),u}validateSessionStatusThrottled(){return localStorage.getItem("_ms-mid")?this.throttle(()=>this.validateSessionStatus(),"lastSessionValidation",3*60*1e3):Promise.resolve(null)}}a(),document.addEventListener(n.GET_APP,async()=>{console.log("getApp");const r=new g;if(await r.validateSessionStatus()){await r.logout(),window.location.href="/";return}})});
